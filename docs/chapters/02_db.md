# 2. データベース（コード準拠）

## 2.1 テーブル一覧
- **assets**: `id, class, name, note, acquired_at, book_value_jpy, valuation_source, liquidity_tier, tags, created_at, updated_at`
- **valuations**: `id, asset_id, as_of, value_jpy, fx_context(JSON), unit_price_jpy`
- **price_cache**: `key(PK), payload(JSON), fetched_at`
- **us_stocks**: `asset_id(PK), ticker, exchange, quantity(REAL), avg_price_usd(REAL)`
- **jp_stocks**: `asset_id(PK), code, quantity(REAL), avg_price_jpy(REAL)`
- **precious_metals**: `asset_id(PK), metal, weight_g(REAL), purity(0-1), unit_price_jpy(REAL)`
- **watches**: `asset_id(PK), brand, model, ref, box_papers(BOOLEAN)`
- **real_estates**: `asset_id(PK), address, land_area_sqm, building_area_sqm, rights`
- **collections**: `asset_id(PK), category, variant`
- **cashes**: `asset_id(PK), currency('JPY'既定), balance(REAL)`
- **attachments**: `id, asset_id, filename, url, notes, created_at, updated_at`
- **comparable_sales**: `id, asset_id, sale_date(YYYY-MM-DD), price, currency, price_jpy, source, source_url, marketplace, condition_grade, completeness, notes, created_at, updated_at`
- **settings**: `key(PK), value`
- **target_allocations**: `class(PK), target_pct(REAL)`
- **audit_log**: `id, table_name, record_id, action, old_values, new_values, user_id, source, created_at`
- **users**: `id, username(UNIQUE), password_hash, role('viewer'|'admin'), created_at`

## 2.2 インデックス/制約（migrations 準拠）
- `idx_valuations_asset_asof(asset_id, as_of DESC, id DESC)`
- `settings.key`/`target_allocations.class`/`price_cache.key` はPK